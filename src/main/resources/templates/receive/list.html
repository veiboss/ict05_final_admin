<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="robots" content="noindex">
    <meta name="googlebot" content="noindex">
    <!-- Bootstrap CSS CDN -->
    <th:block th:replace="~{fragments/head :: commonHead}"></th:block>

    <link href="/admin/css/toast.css" rel="stylesheet"/>
    <script src="/admin/js/lib/jquery-3.2.1.min.js"></script>
    <script src="/admin/js/toast.js"></script>

    <style>
        .overlay {
          display: none;
          position: fixed;
          top: 0; left: 0; width: 100%; height: 100%;
          background: rgba(0,0,0,0.5);
          z-index: 9999;

          /* 중앙 정렬을 위한 Flexbox 설정 */
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .overlay.active {
          display: flex; /* active 상태일 때 flex 정렬 유지 */
        }

        .pop-close {
          width: 48px;   /* 버튼 크기 증가 */
          height: 48px;
          padding: 8px;
          border: none;
          background: transparent;
          cursor: pointer;
        }

        /* SVG 아이콘 크기도 키움 */
        .pop-close svg {
          width: 30px;
          height: 30px;
        }

        /* 팝업 박스 자체 크기 고정 */
        .popup {
          background: white;
          width: 550px;
          max-width: 95vw; /* 모바일 대응 시 가로 최대 폭 제한 */
          height: 750px;        /* 고정 높이 */
          border-radius: 8px;
          overflow: hidden;     /* 스크롤은 내부에서 처리 */
          display: flex;
          flex-direction: column;
        }

        /* 팝업 body 부분만 스크롤되도록 */
        .popup-body {
          flex: 3;                       /* 남은 공간 모두 차지 */
          overflow-y: auto;             /* 내용이 넘칠 때만 스크롤 */
          padding: 25px;
        }

        .popup-body .box-wrap {
          margin: 12px;
          padding: 20px;
          background: #ffffff;
          border-radius: 8px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        /* 주문정보, 가맹점정보 나란히 */
        .info-row {
          display: flex;
          gap: 15px;
          margin-bottom: 20px;
        }

        .info-card {
          flex: 1;
          display: flex;
          flex-direction: column;
          background: #f9f9f9;
          border-radius: 8px;
          padding: 15px 20px;
          box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
          box-sizing: border-box;
          min-height: 100%; /* ✅ 높이 균형 유지 */
        }

        .info-card h4 {
          margin-bottom: 12px;
          font-size: 14px;
          font-weight: 600;
          color: #222;
        }

        .info-line {
          display: flex;
          justify-content: space-between;
          flex-wrap: wrap;             /* ✅ 길면 다음 줄로 */
          margin-bottom: 10px;
        }

        .info-line .label {
          font-weight: 500;
          flex: 0 1 auto;
          min-width: 90px;
          word-break: break-word;
        }

        .info-line .value {
          font-weight: 400;
          color: #222;
          text-align: right;
          flex: 1 1 auto;
          min-width: 100px;
          word-break: break-word;
          <!--white-space: normal !important;  /* ✅ 강제로 줄바꿈 허용 */-->
        }


    </style>
</head>
<body>
<div id="wrap" class="frame">
    <div th:replace="~{fragments/header :: header}"></div>

    <div id="container" class="container">
        <div class="title-bar">
            <h2 class="page-title ellipsis">수주 현황</h2>
        </div>

        <main id="content">
            <div class="box-wrap">
                <div id="search" class="search">
                    <form name="frm" id="frm" method="get">
                        <fieldset>
                            <legend class="blind">검색</legend>
                            <div class="pack-both">
                                <div class="pack-left">
                                    <select title="검색옵션" name="type" class="select medium">
                                        <option value="" th:selected="${receiveOrderSearchDTO.type == null or receiveOrderSearchDTO.type == ''}">선택</option>
                                        <option value="title" th:selected="${receiveOrderSearchDTO.type == 'storeName'}">가맹점명</option>
                                        <option value="content" th:selected="${receiveOrderSearchDTO.type == 'orderCode'}">주문번호</option>
                                        <option value="all" th:selected="${receiveOrderSearchDTO.type == 'storeLocation'}">지역</option>
                                    </select>
                                    <input title="검색어" type="text" name="s" th:value="${receiveOrderSearchDTO.s}" class="form-control" placeholder="검색어를 입력해 주세요" />
                                    <input type="submit" value="검색" class="btn medium color1"/>
                                </div>

                                <div class="pack-left">
                                    <select title="뷰사이즈" th:field="${receiveOrderSearchDTO.size}" class="select medium">
                                        <option value="10">10</option>
                                        <option value="30">30</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>

                <section class="pack-down">
                    <div class="list-header pack-both">
                        <div class="pack-left">
                            <a href="/admin/material/write" class="btn small color1">글쓰기</a>
                        </div>
                        <div class="pack-left">
                            <button type="button" class="btn small bdr-color1" onclick="excelDownload()">액셀다운로드</button>
                        </div>
                    </div>

                    <table class="data-table">
                        <thead>
                        <tr>
                            <!--<th scope="col"><input type="checkbox" name="" id="selectAll"/></th>-->
                            <th scope="col">가맹점명</th>
                            <th scope="col">주문번호</th>
                            <th scope="col">지역</th>
                            <th scope="col">상태</th>
                            <th scope="col">우선순위</th>
                            <th scope="col">주문액</th>
<!--                            <th scope="col">품목수</th>-->
                            <th scope="col">배송예정일</th>
                            <th scope="col">관리</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="receiveOrder, stat : ${receiveOrder.content}">
<!--                            <td><input type="checkbox" class="row-checkbox" th:id="'chk-'+${stat.index}" th:value="${receiveOrder.id}" /></td>&ndash;&gt;-->
                            <td th:text="${receiveOrder.storeName}">가맹점명</td>
                            <td th:text="${receiveOrder.orderCode}">주문번호</td>
                            <td th:text="${receiveOrder.storeLocation}">지역</td>
                            <td th:text="${receiveOrder.statusDescription}">상태</td>
                            <td th:text="${receiveOrder.priorityDescription}">우선순위</td>
                            <td th:text="${#numbers.formatInteger(receiveOrder.totalPrice, 0, 'COMMA')} + '원'">주문액</td>
<!--                            <td th:text="${receiveOrder.itemCount}">품목수</td> &lt;!&ndash; 필요 시 DTO에 itemCount 추가 &ndash;&gt;-->
                            <td th:text="${#temporals.format(receiveOrder.deliveryDate, 'yyyy-MM-dd')}">배송예정일</td>
                            <td>
                                <button type="button" class="btn small normal" onclick="openPopup('${receiveOrder.id}')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye h-3 w-3"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div style="text-align: center;">
                        <div th:replace="~{fragments/pagination :: pagination (${receiveOrder})}"></div>
                    </div>
                </section>
            </div>
        </main>
        <div th:replace="~{fragments/footer :: footer}"></div>
    </div><!-- // #container  -->
</div><!--#wrap.frame-->

<!-- popup 시작 -->
<div id="popupId" class="overlay">
    <div class="popup">
        <div class="popup-header">
            <h2 class="popup-title">주문 상세 정보</h2>
            <button type="button" class="btn transparent pop-close" onclick="modalClose('#popupId');" title="팝업 닫기">
                <svg viewBox="0 0 32 32" class="ico svg-close">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="m16 17.414 8.485 8.485 1.415-1.414L17.414 16 25.9 7.515 24.485 6.1 16 14.586 7.515 6.1 6.1 7.515 14.586 16l-8.485 8.485L7.515 25.9 16 17.413z"></path>
                </svg>
            </button>
            <div class="fs-14">
                <p>주문번호 : </p>
            </div>
        </div>

        <hr class="line">
        <div class="popup-body">
             <div class="info-row">
                <div data-th="info-card">
                <!--<div class="row-2">-->
                    <section class="col box-wrap">
                        <h3 style="color: black; font-weight: 600;">주문 정보</h3>
                        <div class="info-line">
                            <div class="label">주문번호:</div>
                            <div class="value">ORD-20240120-001</div>
                        </div>

                        <div class="info-line"><span class="label">주문일:</span><span class="value"></span></div>
                        <div class="info-line"><span class="label">배송예정일:</span><span class="value"></span></div>
                        <div class="info-line"><span class="label">상태:</span><span class="value"></span></div>
                        <div class="info-line"><span class="label">우선순위:</span><span class="value"></span></div>
                    </section>
                </div>

                <div data-th="info-card">
                    <!--<div class="row-2">-->
                    <section class="col box-wrap">
                        <h3 style="color: black; font-weight: 600;">가맹점 정보</h3>
                        <div class="info-line"><span class="label">가맹점명:</span><span class="value">이삭토스트 강남점</span></div>
                        <div class="info-line"><span class="label">매장코드:</span><span class="value"></span></div>
                        <div class="info-line"><span class="label">지역:</span><span class="value"></span></div>
                        <div class="info-line"><span class="label">총 주문액:</span><span class="value"></span></div>
                        <div class="info-line"><span class="label">주문 품목:</span><span class="value"></span></div>
                    </section>
                </div>
             </div>

            <hr class="line">
            <div data-th="card">
                <!--<div class="row-2">-->
                <section class="box-wrap">

                    <h3 style="color: black; font-weight: 600;">주문 상품</h3>

                    <hr class="line">

                    <div data-th="card">
                        <section class="col box-wrap">
                            <div class="pack-both">
                                <table>
                                   <thead>
                                   <tr>
                                       <th>상품명</th>
                                       <th>카테고리</th>
                                       <th>수량</th>
                                       <th>단가</th>
                                       <th>총액</th>
                                       <th>재고상태</th>
                                   </tr>
                                   </thead>
                                   <tbody>
                                   <tr>
                                       <td>상품명</td>
                                       <td>카테고리</td>
                                       <td>수량</td>
                                       <td>단가</td>
                                       <td>총액</td>
                                       <td>재고상태</td>
                                   </tr>
                                   </tbody>
                               </table>
                            </div>
                        </section>
                    </div>
                </section>
            </div>

            <hr class="line">
            <div data-th="card">
                <!--<div class="row-2">-->
                <section class="col box-wrap">
                    <div class="pack-both">
                        <h3 style="color: black; font-weight: 600;">특이 사항</h3>
                    </div>

                    <hr class="line">

                    <textarea class="textarea medium" rows="4" cols="50" placeholder="텍스트에리어"></textarea>
                </section>
            </div>

            <hr class="line">
            <div class="button-area pack-center" style="float: right;">
                <button type="button" class="btn medium bdr-color1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-download h-4 w-4 mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" x2="12" y1="15" y2="3"></line></svg>
                    주문서 다운로드
                </button>
                <button type="reset" class="btn medium color1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-package h-4 w-4 mr-2"><path d="M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z"></path><path d="M12 22V12"></path><polyline points="3.29 7 12 12 20.71 7"></polyline><path d="m7.5 4.27 9 5.15"></path></svg>
                    배송 준비
                </button>
            </div>

        </div>
    </div>
</div><!-- popup 끝 -->

<script>
    const selectAll = document.getElementById('selectAll');

    const getRowCheckboxes = () => Array.from(document.querySelectorAll('.row-checkbox'));

    selectAll.addEventListener('change', () => {
        const all = getRowCheckboxes();
        all.forEach(cb => cb.checked = selectAll.checked);
        selectAll.indeterminate = false;
    });

    document.addEventListener('change', (e) => {
        if (!e.target.classList.contains('row-checkbox')) return;
        updateSelectAllState();
    });

    function updateSelectAllState() {
        const all = getRowCheckboxes();
        if (all.length === 0) {
            selectAll.checked = false;
            selectAll.indeterminate = false;
            return;
        }
        const checkedCount = all.filter(cb => cb.checked).length;
        if (checkedCount === 0) {
            selectAll.checked = false;
            selectAll.indeterminate = false;
        } else if (checkedCount === all.length) {
            selectAll.checked = true;
            selectAll.indeterminate = false;
        } else {
            selectAll.checked = false;
            selectAll.indeterminate = true;
        }
    }

    document.addEventListener('DOMContentLoaded', updateSelectAllState);
</script>
<script>
    function excelDownload() {
        const formData = new FormData(document.getElementById('frm'));
        const type = formData.get("type");
        const s = formData.get("s");
        window.location = `/admin/API/material/download?type=${encodeURIComponent(type)}&s=${encodeURIComponent(s)}`;
    }
</script>
<script>
    function openPopup(orderId) {
        // 팝업 열기
        const popup = document.getElementById('popupId');
        popup.classList.add('active');

        // 이 부분에서 orderId로 AJAX 요청하거나 데이터 바인딩 수행
        // 예시: 콘솔 출력
        console.log("주문 상세 보기: " + orderId);

        // AJAX로 상세 데이터 가져와서 채우기 (예시)
        /*
        fetch('/admin/receive/detail/api/' + orderId)
            .then(response => response.json())
            .then(data => {
                document.querySelector('#popupId .popup-title').textContent = "주문 상세 정보 - " + data.orderNumber;
                document.querySelector('#popupId p:nth-child(1)').textContent = "주문번호: " + data.orderNumber;
                ...
            });
        */
    }

    // 팝업 닫기 함수 (기존 코드 참고)
    function modalClose(selector) {
        const popup = document.querySelector(selector);
        popup.classList.remove('active');
    }
</script>
</body>
</html>
